魔兽世界多开脚本开发
==============================================================================


挑战
------------------------------------------------------------------------------
玩多开的核心体验是一个人尝试不同的职业搭配, 从而做到一些脑洞大开的事情. 而不停地尝试不同的队伍人数, 职业搭配, 天赋搭配是一个绕不开的过程. 并且就算你有一套固定的搭配, 你也很难用一套按键和技能设置应对所有的场景. 比如不同的 Boss 站, 战场, 会有不同的技能施放策略. 这么多因素组合起来就是几百种不同的搭配. 很显然你不可能为所有的场景都创建一份 HotkeyNet 的脚本.

在编程的角度看, 解决这个问题的关键就是解耦, 把组合起来的因素分拆成各自独立的因素. 并且尽量利用程序的自动化来帮你做重复的复制粘贴工作. ``hotkeynet`` Python 库提供了这一可能性. 但是你仍然需要编程的经验, 才能正确的将各个因素拆分成相互尽可能独立的模块. 同时留有可扩展的可能性. 这仍然不是一件容易得事情.


需求分析
------------------------------------------------------------------------------
注:

    每个人的需求不一样, 有的人需求简单, 有的人需求复杂. 我希望用一个比较复杂的例子来说明, 如何用 hotkeynet 这个库来实现几乎无数种玩法的可能性.

**游戏角色**

我个人有 40 个 80 级的号, 其中 10 个已经准毕业, 6300 GS 以上; 20 个已经可以参与 ICC, 6000 GS 以上; 10 个刚过 ICC 的门槛 5500 GS 左右. 这 40 个号大部分都有双天赋. 这些号都是自己练的, 平均每个号从商城购买了 1 件核心装备, 都是从 1 升到 80, 然后单刷小副本, 团队副本, 战场, 最后参加工会团的成果. 这套系统在整个过程中都发挥了作用.

**多开玩法**

我们有以下主要玩法, 每种玩法中会有不同的队伍组合搭配.

1. 升级, 大号带小号或者 5 个号一起组队升级.
2. 单刷 5 人小副本.
3. 在野外做日常周常刷钱刷声望.
4. 战场, 竞技场 PK.
5. 单刷 10 人小团本.
6. 单刷 25 人大团本.


多开脚本的组织框架
------------------------------------------------------------------------------
首先, 我们设计了一套面向对象的系统. 其中有这么一些核心的对象:

- Window: 代表一个游戏客户端窗口.
- Account: 代表一个服务器账号, 有账号和密码.
- Character: 一个服务器账号下的具体角色, 有具体的天赋. 以及一些额外信息, 例如这个角色是不是一个司机, 是不是一个坦克.
- Talent: 一个角色的具体天赋.
- TalentCategory: 天赋所属于的类别, 比如是 PvE 还是 PvP, 是 Tank 还是 DPS.
- Action: 一个具体的动作, 例如施放某个技能. 该动作将会由 Hotkey 触发, 然后再客户端内模拟人类按下快捷键.

然后我们设计了一套按键操作的模式. 这套模式不假设你使用某个具体的角色, 而是定义了各个职业和各个天赋下, 按每个键都对应什么样的功能. 例如:

- 任何职业按 Numpad 0 是跟随焦点, Numpad 11 是上马.
- 任何法师角色按 1,2,3,4 都是跟随焦点打怪.
- 还有各种治疗, 驱散, 刷 buff, 集合, 分散 等等几十种按键.

这套模式可以适用 90% 的情况. 而另外 10% 只需要在这套模式的基础上进行少量修改即可.

基于这套模式, 我们就可以专注于定义在不同的玩法下, 我们要上哪些号, 哪些号是司机, 哪些号是什么天赋, 哪个号在哪个游戏窗口里玩. 那么程序就能自动根据上面的操作模式, 根据每个角色在哪个窗口, 是什么天赋, 自动生成按下各种 Hotkey 所实际进行的 Action.

而我们还可以根据特殊场景设置一些 hook (钩子函数), 在生成代码前运行一些特殊的自定义逻辑, 例如在某个特定的 Boss 站的时候, 我们有一个特殊的快捷键会覆盖普通模式中的按键, 有着特殊的功能.

通过以上方式, 我们只要一次花点时间配置好游戏客户端, 动作条, 宏, 以及脚本. 就可以用不同人物的排列组合, 去玩不同的玩法了. 而在不同玩法之间切换, 你只需要在代码中把所有玩法包装成一个函数, 然后用开关注释的方式选择用哪个队伍的哪个玩法. 每次切换玩法前只要按一下运行, 然后 HotkeyNet reload 一下即可.


多开脚本生成的流程
------------------------------------------------------------------------------
